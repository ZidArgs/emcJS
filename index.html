<html>
    <head>
        <title>deepJS sandbox</title>
        <meta charset="UTF-8">
        <meta name="description" content="Test for deepJS components">
        <meta name="robots" content="none">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta name="theme-color" content="#000000">
        <script type="module">
            import deepJS from "./index.js";

            function recTransformLogic(logic) {
                if (["true","false","not","and","nand","or","nor","xor","min","max"].indexOf(logic.type)<0) {
                    logic.el = `${logic.type}.${logic.el}`;
                } else {
                    if (!!logic.el) {
                        if (Array.isArray(logic.el)) {
                            for (let i in logic.el) {
                                logic.el[i] = recTransformLogic(logic.el[i]);
                            }
                        } else {
                            logic.el = recTransformLogic(logic.el);
                        }
                    }
                }
                return logic;
            }

            function transformLogic(logic) {
                let res = {};
                
                for (let i of Object.keys(logic)) {
                    for (let j of Object.keys(logic[i])) {
                        res[`${i.slice(0,-1)}.${j}`] = recTransformLogic(logic[i][j]);
                    }
                }

                return res;
            }

            let logic = {};

            async function init() {
                logic = await deepJS.util.FileLoader.json(`logic.json`);

                let logicProcessor = new deepJS.util.logic.Processor();
                logicProcessor.loadLogic(logic);

                console.time("logic exec");
                console.log(logicProcessor.execute({
                    "option.trade_sequence_start_item": "10",
                    "option.water_trial": false,
                    "option.keysanity_boss": "keysanity_boss_keysanity",
                    "option.consider_buyable": false,
                    "option.doors_open_temple": true,
                    "option.spirit_trial": false,
                    "option.ganon_castle_open": "ganon_castle_open_medallion",
                    "option.beansanity": true,
                    "option.bombchu_logic": false,
                    "option.shadow_trial": false,
                    "option.ganon_boss_door_open": false,
                    "option.keysanity_small": "keysanity_small_keysanity",
                    "option.doors_open_zora": false,
                    "option.cowsanity": false,
                    "option.gerudo_fortress_open": "gerudo_fortress_open_default",
                    "option.scrubsanity": true,
                    "option.forest_trial": false,
                    "option.light_trial": false,
                    "option.fire_trial": false,
                    "option.doors_open_forest": true
                }));
                console.timeEnd("logic exec");

                console.time("logic exec");
                console.log(logicProcessor.execute({
                    "item.ocarina": true,
                    "item.song_storm": true
                }));
                console.timeEnd("logic exec");

                console.time("logic exec");
                console.log(logicProcessor.execute({
                    "item.ocarina": false,
                    "item.song_storm": true
                }));
                console.timeEnd("logic exec");

                console.time("logic exec");
                console.log(logicProcessor.execute({
                    "item.bombs": true,
                    "item.ocarina": true,
                    "item.song_storm": true
                }));
                console.timeEnd("logic exec");

                console.time("logic exec");
                console.log(logicProcessor.execute({
                    "item.ocarina": false,
                    "item.song_storm": false,
                }));
                console.timeEnd("logic exec");

                console.time("logic get values");
                console.log(logicProcessor.getValues());
                console.timeEnd("logic get values");
            }

            init();

            document.getElementById('savelogic').onclick = downloadLogic;

            async function downloadLogic() {
                deepJS.util.FileSystem.save(JSON.stringify(logic, " ", 4), `logic.json`);
            }

        </script>
    </head>
    <body>
        <button id="savelogic">down</button>
    </body>
</html>